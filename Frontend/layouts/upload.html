<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subir Videos</title>
    <link rel="stylesheet" href="styleSub.css">
</head>
<body>

    {{> header}}

    <main class="container">
        <a href="index.html" class="back-button" title="Volver al inicio">‚Üê</a>
        
        <div class="header">
            <h1>Subir Videos</h1>
            <p>Selecciona o arrastra los videos que deseas subir</p>
        </div>

        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <div class="upload-icon">üé¨</div>
            <div class="upload-text">Haz clic aqu√≠ o arrastra videos</div>
            <div class="upload-hint">Solo archivos de video permitidos</div>
            <input type="file" id="fileInput" class="file-input" multiple accept="video/*">
        </div>

        <div class="progress-bar" id="progressBar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <div class="file-list" id="fileList"></div>

        <button class="upload-button" id="uploadBtn" onclick="uploadFiles()" disabled>
            Subir Videos
        </button>

        <div class="restrictions">
            <h3>üìã Restricciones:</h3>
            <ul>
                <li>Tama√±o m√°ximo por video: 100MB</li>
                <li>Formatos permitidos: MP4, AVI, MOV, WMV, FLV, MKV</li>
                <li>M√°ximo 3 videos simult√°neamente</li>
                <li>Resoluci√≥n recomendada: hasta 1080p</li>
            </ul>
        </div>
    </main>

    {{> footer}}

    <script>
        let selectedFiles = [];
        const maxFileSize = 100 * 1024 * 1024; // 100MB
        const maxFiles = 3;
        const allowedTypes = [
            'video/mp4', 'video/avi', 'video/quicktime', 'video/x-msvideo',
            'video/x-flv', 'video/x-matroska', 'video/x-ms-wmv'
        ];

        // Eventos para drag & drop
        const uploadArea = document.querySelector('.upload-area');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight(e) {
            uploadArea.classList.add('dragover');
        }

        function unhighlight(e) {
            uploadArea.classList.remove('dragover');
        }

        uploadArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }

        // Manejar selecci√≥n de archivos
        document.getElementById('fileInput').addEventListener('change', function(e) {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            ([...files]).forEach(addFile);
            updateFileList();
            updateUploadButton();
        }

        function addFile(file) {
            if (selectedFiles.length >= maxFiles) {
                alert(`Solo puedes subir m√°ximo ${maxFiles} videos`);
                return;
            }

            if (file.size > maxFileSize) {
                alert(`El video ${file.name} excede el tama√±o m√°ximo de 100MB`);
                return;
            }

            if (!allowedTypes.includes(file.type)) {
                alert(`El formato del video ${file.name} no est√° permitido`);
                return;
            }

            // Evitar duplicados
            if (selectedFiles.find(f => f.name === file.name && f.size === file.size)) {
                alert(`El video ${file.name} ya est√° seleccionado`);
                return;
            }

            selectedFiles.push(file);
        }

        function updateFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';

            selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                    <button class="file-remove" onclick="removeFile(${index})">√ó</button>
                `;
                fileList.appendChild(fileItem);
            });
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
            updateUploadButton();
        }

        function updateUploadButton() {
            const uploadBtn = document.getElementById('uploadBtn');
            uploadBtn.disabled = selectedFiles.length === 0;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function uploadFiles() {
            if (selectedFiles.length === 0) return;

            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            const uploadBtn = document.getElementById('uploadBtn');

            progressBar.style.display = 'block';
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'Subiendo...';

            // Simulaci√≥n de progreso (aqu√≠ implementar√≠as la l√≥gica real de subida)
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                progressFill.style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        alert('¬°Videos subidos exitosamente!');
                        resetForm();
                    }, 500);
                }
            }, 200);
        }

        function resetForm() {
            selectedFiles = [];
            updateFileList();
            updateUploadButton();
            document.getElementById('progressBar').style.display = 'none';
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('uploadBtn').textContent = 'Subir Videos';
            document.getElementById('fileInput').value = '';
        }
    </script>
</body>
</html>