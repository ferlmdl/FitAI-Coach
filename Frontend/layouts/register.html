<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro - FIT AI</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/styleReg.css">
</head>
<body>
    
    {{> header}}

        <div class="registro-container">
            <div class="registro-box">
                <h1>Únete a FIT AI</h1>
                <p>Crea tu cuenta y comienza tu transformación</p>
                
                <form class="registro-form" id="registroForm">
                    <div class="form-group">
                        <label for="nombreReal">Nombre Completo</label>
                        <input type="text" id="nombreReal" name="nombreReal" placeholder="Juan Pérez" required>
                    </div>

                    <div class="form-group">
                        <label for="nombreUsuario">Nombre de Usuario</label>
                        <input type="text" id="nombreUsuario" name="nombreUsuario" placeholder="tu_usuario" required>
                    </div>

                    <div class="form-group">
                        <label for="correo">Correo Electrónico</label>
                        <input type="email" id="correo" name="correo" placeholder="tu@email.com" required>
                    </div>

                    <div class="form-group">
                        <label for="contrasena">Contraseña</label>
                        <input type="password" id="contrasena" name="contrasena" placeholder="••••••••" required>
                        <div class="password-requirements" id="passwordReqs">
                            <p>La contraseña debe cumplir:</p>
                            <div class="req-item" id="req-length">
                                <span class="req-icon">✓</span>
                                <span>Mínimo 8 caracteres</span>
                            </div>
                            <div class="req-item" id="req-upper">
                                <span class="req-icon">✓</span>
                                <span>Al menos 1 mayúscula</span>
                            </div>
                            <div class="req-item" id="req-lower">
                                <span class="req-icon">✓</span>
                                <span>Al menos 1 minúscula</span>
                            </div>
                            <div class="req-item" id="req-number">
                                <span class="req-icon">✓</span>
                                <span>Al menos 1 número</span>
                            </div>
                            <div class="req-item" id="req-symbol">
                                <span class="req-icon">✓</span>
                                <span>Al menos 1 símbolo (!@#$%^&*-_)</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="confirmarContrasena">Confirmar Contraseña</label>
                        <input type="password" id="confirmarContrasena" name="confirmarContrasena" placeholder="••••••••" required>
                        <div id="passwordMatch" class="password-match"></div>
                    </div>

                    <div class="form-checkbox">
                        <label>
                            <input type="checkbox" name="terminos" required>
                            Acepto los términos y condiciones
                        </label>
                    </div>

                    <button type="submit" class="btn-registro-submit">Registrarse</button>
                </form>

                <div class="registro-footer">
                    <p>¿Ya tienes cuenta? <a href="login.html">Inicia sesión aquí</a></p>
                </div>
            </div>
        </div>

    <footer class="footer container">
        <h3>FIT AI</h3>
        <div class="links">
            <ul>
                <li><a href="IndexV2.html">Inicio</a></li>
                <li><a href="Galeria.html">¿Quién somos?</a></li>
                <li><a href="Galeria.html">Funcionamiento</a></li>
                <li><a href="#">Hablanos</a></li>
            </ul>
    </main>

    {{> footer}}

<script>
    const registroForm = document.getElementById('registroForm');
    const contrasenaInput = document.getElementById('contrasena');
    const confirmarContrasenaInput = document.getElementById('confirmarContrasena');
    const passwordMatch = document.getElementById('passwordMatch');

    const requirements = {
        length: { validator: (password) => password.length >= 8, el: document.getElementById('req-length') },
        upper: { validator: (password) => /[A-Z]/.test(password), el: document.getElementById('req-upper') },
        lower: { validator: (password) => /[a-z]/.test(password), el: document.getElementById('req-lower') },
        number: { validator: (password) => /[0-9]/.test(password), el: document.getElementById('req-number') },
        symbol: { validator: (password) => /[!@#$%^&*\-_]/.test(password), el: document.getElementById('req-symbol') }
    };

    contrasenaInput.addEventListener('input', () => {
        const password = contrasenaInput.value;
        Object.values(requirements).forEach(req => {
            req.el.classList.toggle('met', req.validator(password));
        });
        checkPasswordMatch();
    });

    confirmarContrasenaInput.addEventListener('input', checkPasswordMatch);

    function checkPasswordMatch() {
        if (confirmarContrasenaInput.value === '') {
            passwordMatch.textContent = '';
            passwordMatch.className = 'password-match';
            return;
        }
        if (contrasenaInput.value === confirmarContrasenaInput.value) {
            passwordMatch.textContent = '✓ Las contraseñas coinciden';
            passwordMatch.className = 'password-match match';
        } else {
            passwordMatch.textContent = '✗ Las contraseñas no coinciden';
            passwordMatch.className = 'password-match no-match';
        }
    }

    registroForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const password = contrasenaInput.value;
        const allRequirementsMet = Object.values(requirements).every(req => req.validator(password));

        if (!allRequirementsMet) {
            alert('La contraseña no cumple todos los requisitos.');
            return;
        }
        if (password !== confirmarContrasenaInput.value) {
            alert('Las contraseñas no coinciden.');
            return;
        }

        const formData = new FormData(registroForm);
        const data = {
            nombreReal: formData.get('nombreReal'),
            nombreUsuario: formData.get('nombreUsuario'),
            email: formData.get('correo'),
            password: formData.get('contrasena')
        };

        try {
            const response = await fetch('/api/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await response.json();

            if (response.ok) {
                alert('¡Registro exitoso! Serás redirigido para iniciar sesión.');
                window.location.href = '/login.html';
            } else {
                alert(`Error: ${result.error}`);
            }
        } catch (error) {
            console.error('Error de conexión:', error);
            alert('No se pudo conectar con el servidor.');
        }
    });
</script>
</body>
</html>